---
title: Merkle树
description: 哈希树
published: true
date: 2022-04-17T15:33:31.705Z
tags: 
editor: markdown
dateCreated: 2022-04-17T13:07:22.059Z
---

# 墨克树 / Merkle树 / 哈希树

## 什么是 Merkle tree

待补充，这里先看[wikipedia](https://zh.wikipedia.org/wiki/%E5%93%88%E5%B8%8C%E6%A0%91)

## 应用场景

那么Merkle tree有什么用呢？这里举一个例子

**抽奖游戏:**

我这里有一个盒子，里面放着1000张卡片，支付×××就可以抽卡一次。
这1000张卡片上，分别写着各种奖项，其中 有1张一等奖，3张二等奖，8张3等奖，其余安慰奖。抽完50张后，其余950张卡片销毁，本次活动结束。

但是用户并不信任老板，并提出了多项质疑。

##### 用户：你怎么证明卡片是随机抽取的，而不是你精心挑选后发给我的？
我可以把所有卡片扣在桌面上，并编号1-1000，你自己挑选其中一个数字后，翻开那张卡片，在此之前，谁也不能碰那些卡片。

##### 用户：但这是网上抽奖，我怎么知道卡片上的内容不是在我选定编号后的瞬间临时生成的？以及我怎么知道你卡池里到底有没有一等奖？
我可以把所有卡片上的内容，按照编号顺序，进行特定的编码。比如"4123"表有4张卡片，第1张是安慰奖，第2张是一等奖，第3张是二等奖，第4张是三等奖……

##### 用户：等等，你要公布这个编码的内容么？那不就事先暴露卡片的内容了？
假如把这个编码的内容称为X，但我肯定不能直接公布X，不然抽奖就没意义了，我会在抽奖开始前，先计算并公布它的SHA-256哈希值Y（即Y=sha256(X))，用户无法根据Y推测X的内容。等50次抽取结束后，我会公布X，证明Y=sha256(X)，这表示我一开始公布的Y不是瞎编的。

##### 用户：我明白你不会改变Y的值，但是就不会有另一个值X~2~使得sha256(X~2~)=Y吗？
有，这样的X~2~肯定存在，但是你知道我只是个凡人，我肯定找不出来两个不同的值，却有相同sha256值。据我所知迄今为止世界上还没有人能做到这样的事。所以我最后只能公布一开始就设定好的X值，而不会找一个X~2~来充数。如果我找不到这样的X值，你们都会来找我算账的。

##### 用户：好吧我相信卡片在活动开始后卡片上的内容都没动过，但是你要在抽完50张卡片后公布X值，万一我不想等那么久怎么办，还是说你其实永远也打算不公布X值了？
我们除了公布1000张卡片整体的哈希值，还可以把1000张卡片分别求哈希值并公布，这样你不用等待其他就可以证明我们没有作弊了。

##### 用户：那……万一你最后无法公布出正确的X我要怎么找你算账？
我们可以把整个抽奖过程搬到区块链上，用智能合约来保证规则被正确的执行，一旦最后我无法公布正确的X值，整个抽奖活动会自动作废，你们的钱会自动退回原来的账户。

##### 用户：1001个哈希值全都存到区块链上，岂不是很浪费空间？
我们可以使用Merkle tree，把这1000张卡片做为叶子节点，然后事先公布整个树的哈希值。每个人抽卡时，我只要公布这个节点到根节点路径上所有节点（即所有祖先节点）的直系子节点的哈希值，就能证明我没有骗你了。
所以说我们刚其实只需要存储1个哈希值，那就是根节点的哈希值。

##### 用户：呃……好吧……那……我怎么知道其他用户不是你的“托儿”？
这……这好像保证不了，不过我们可以这样修改规则：改为每轮活动在一等奖被抽走后立刻结束。只要用一点数学知识稍作推导，就知道这样的情况写，无论是否有“托儿”，都无法降低其他人抽到一等奖的概率。

###### 用户：额…………诶？是吗？





